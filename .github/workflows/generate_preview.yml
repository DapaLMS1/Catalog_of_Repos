steps:
  - name: Checkout repository code
    uses: actions/checkout@v4

  - name: Setup Node.js
    uses: actions/setup-node@v4
    with:
      node-version: '20'

  # ------------------------------------------------------------------
  # --- STEP A: AUTOMATIC IMAGE GENERATION SCRIPT EXECUTION ---
  # ------------------------------------------------------------------
  # This step executes the 'generate_preview_script.js' file in the root of your repo,
  # which is responsible for creating a valid PNG file named 'preview.png'.
  - name: Generate Preview Image via Node.js Script
    run: node generate_preview_script.js

  # ------------------------------------------------------------------

  # --- STEP B: Commit and Push the New File ---
  # This action checks if 'preview.png' was created or modified.
  - name: Check for changes and commit
    id: commit
    uses: stefanzweifel/git-auto-commit-action@v5
    with:
      commit_message: 'docs: Auto-generated social media preview card (preview.png)'
      # Ensure only the specific file the Canvas is looking for is committed
      file_pattern: preview.png

  - name: Report Status
    if: steps.commit.outputs.changes_detected == 'true'
    run: echo "Successfully generated and committed preview.png."

  - name: Report No Changes
    if: steps.commit.outputs.changes_detected == 'false'
    run: echo "No changes detected, skipping commit."
